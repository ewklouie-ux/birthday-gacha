<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="/birthday-gacha/site.webmanifest">
<link rel="icon" type="image/png" sizes="192x192" href="/birthday-gacha/icons/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/birthday-gacha/icons/android-chrome-512x512.png">
<link rel="apple-touch-icon" href="/birthday-gacha/icons/apple-touch-icon.png">

<title>Birthday Limited Banner</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #111433, #0b0d1a);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#app {
  width: 100%;
  max-width: 420px;
  padding: 20px;
  text-align: center;
  transition: opacity 0.4s ease, filter 0.4s ease;
}

.locked {
  opacity: 0.12;
  filter: blur(6px);
  pointer-events: none;
}

/* LEVEL BAR */
#levelBox {
  background:#0f1220;
  padding:10px;
  border-radius:12px;
  margin-bottom:12px;
}
#levelText {
  font-size:.9rem;
  opacity:.85;
}
#xpBar {
  height:8px;
  background:#1a1d33;
  border-radius:999px;
  overflow:hidden;
  margin-top:6px;
}
#xpFill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#4f46e5,#a855f7);
  transition:width .4s ease;
}

#result {
  min-height: 120px;
  max-height: 45vh;
  overflow-y: auto;
}

.card {
  margin: 6px 0;
  padding: 12px;
  border-radius: 14px;
  background: #1a1d33;
}

.Common { border-left: 6px solid #b0b0b0; }
.Rare { border-left: 6px solid #4da6ff; }
.Epic { border-left: 6px solid #b066ff; }
.Legendary { border-left: 6px solid gold; }

button {
  width: 100%;
  padding: 14px;
  font-size: 1.1rem;
  border-radius: 14px;
  border: none;
  background: #4f46e5;
  color: white;
  cursor: pointer;
  margin-top: 10px;
}

#historyBtn { background:#2a2e5a; }
#titleBtn { background:#1f234a; }

/* OVERLAYS */
#bannerSplash, #historyOverlay, #legendaryOverlay {
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  text-align:center;
}

#bannerSplash {
  z-index:4000;
  background:radial-gradient(circle at top,rgba(255,215,0,.22),rgba(0,0,0,.98));
  backdrop-filter:blur(14px);
}

#historyOverlay {
  z-index:3000;
  background:#0f1220;
  padding:20px;
  overflow-y:auto;
}

#legendaryOverlay {
  z-index:5000;
  background:radial-gradient(circle,rgba(255,215,0,.35),rgba(0,0,0,.95));
  backdrop-filter:blur(6px);
}
</style>
</head>

<body>

<div id="bannerSplash">
  <div>
    <h1 style="font-size:2.6rem;">ðŸŽ‚ LIMITED BIRTHDAY BANNER ðŸŽ‚</h1>
    <p style="opacity:.85;margin:16px 0;">Available for a limited time only</p>
    <button id="enterBanner">Enter Banner</button>
  </div>
</div>

<div id="app">
  <div id="levelBox">
    <div id="levelText">Level 1 Â· 0 / 100 XP</div>
    <div id="xpBar"><div id="xpFill"></div></div>
  </div>

  <div id="result"></div>

  <button id="rollBtn">ðŸŽ² Roll Ã—10</button>
  <button id="historyBtn">ðŸ“œ History</button>
  <button id="titleBtn">ðŸŽ‚ Title Screen</button>
</div>

<div id="historyOverlay">
  <button id="closeHistory">Close</button>
  <h2>Roll History</h2>
  <div id="historyList"></div>
</div>

<div id="legendaryOverlay">
  <div>
    <h1>ðŸŒŸ LEGENDARY ðŸŒŸ</h1>
    <p id="legendaryPrize"></p>
    <button id="ackLegendary">Accept Gift</button>
  </div>
</div>

<script>
let isRolling=false;

const STORAGE_LOG="birthday_log";
const STORAGE_XP="birthday_xp";

const xpValues={Common:10,Rare:25,Epic:60,Legendary:120};

const rewardPools={
  Epic:["Prepared note","Small gift","10-minute massage"],
  Legendary:["Main Birthday Gift","Deep Handwritten Letter"]
};

const app=document.getElementById("app");
const banner=document.getElementById("bannerSplash");
const history=document.getElementById("historyOverlay");
const legendary=document.getElementById("legendaryOverlay");

const rollBtn=document.getElementById("rollBtn");
const historyBtn=document.getElementById("historyBtn");
const titleBtn=document.getElementById("titleBtn");
const enterBanner=document.getElementById("enterBanner");
const closeHistory=document.getElementById("closeHistory");
const ackLegendary=document.getElementById("ackLegendary");

const result=document.getElementById("result");
const historyList=document.getElementById("historyList");
const levelText=document.getElementById("levelText");
const xpFill=document.getElementById("xpFill");
const legendaryPrize=document.getElementById("legendaryPrize");

function getXP(){return JSON.parse(localStorage.getItem(STORAGE_XP))||{xp:0,level:1};}
function saveXP(d){localStorage.setItem(STORAGE_XP,JSON.stringify(d));}
function xpNeeded(l){return 100+Math.floor(l*25);}

function updateLevelUI(){
  const d=getXP();
  const need=xpNeeded(d.level);
  levelText.textContent=`Level ${d.level} Â· ${d.xp} / ${need} XP`;
  xpFill.style.width=Math.min(100,(d.xp/need)*100)+"%";
}

function logRoll(e){
  const l=JSON.parse(localStorage.getItem(STORAGE_LOG))||[];
  l.push(e);
  localStorage.setItem(STORAGE_LOG,JSON.stringify(l));
}

function rollOnce(){
  const n=Math.random()*100;
  if(n<1)return"Legendary";
  if(n<10)return"Epic";
  if(n<30)return"Rare";
  return"Common";
}

function getReward(r){
  return rewardPools[r]?.[Math.floor(Math.random()*rewardPools[r].length)]||null;
}

/* TITLE */
function showTitle(){banner.style.display="flex";app.classList.add("locked");}
function hideTitle(){banner.style.display="none";app.classList.remove("locked");}
showTitle();

enterBanner.onclick=hideTitle;
titleBtn.onclick=()=>!isRolling&&showTitle();

/* HISTORY */
historyBtn.onclick=()=>{
  history.style.display="block";
  historyList.innerHTML="";
  const l=JSON.parse(localStorage.getItem(STORAGE_LOG))||[];
  l.slice().reverse().forEach(e=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<strong>${e.rarity}</strong> +${e.xp} XP<br>${e.reward||""}`;
    historyList.appendChild(d);
  });
};
closeHistory.onclick=()=>history.style.display="none";

/* ROLL */
rollBtn.onclick=async()=>{
  isRolling=true;
  rollBtn.disabled=true;
  result.innerHTML="";

  for(let i=0;i<10;i++){
    await new Promise(r=>setTimeout(r,200));
    const r=rollOnce();
    const xp=xpValues[r];
    const reward=getReward(r);

    const d=getXP();
    d.xp+=xp;
    while(d.xp>=xpNeeded(d.level)){d.xp-=xpNeeded(d.level);d.level++;}
    saveXP(d);
    updateLevelUI();

    logRoll({rarity:r,xp,reward});

    const c=document.createElement("div");
    c.className=`card ${r}`;
    c.innerHTML=`<strong>${r}</strong><br>+${xp} XP${reward?`<br>${reward}`:""}`;
    result.appendChild(c);

    if(r==="Legendary"){
      legendaryPrize.textContent=reward;
      app.classList.add("locked");
      legendary.style.display="flex";
      break;
    }
  }

  rollBtn.disabled=false;
  isRolling=false;
};

ackLegendary.onclick=()=>{
  legendary.style.display="none";
  app.classList.remove("locked");
};

updateLevelUI();
</script>
</body>
</html>
