<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>  <meta name="mobile-web-app-capable" content="yes">  
<meta name="theme-color" content="#4f46e5">  
<meta name="apple-mobile-web-app-capable" content="yes">  
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  <link rel="manifest" href="/birthday-gacha/site.webmanifest">  
<link rel="icon" type="image/png" sizes="192x192" href="/birthday-gacha/icons/android-chrome-192x192.png">  
<link rel="icon" type="image/png" sizes="512x512" href="/birthday-gacha/icons/android-chrome-512x512.png">  
<link rel="apple-touch-icon" href="/birthday-gacha/icons/apple-touch-icon.png">  
  
<title>Birthday Limited Banner</title>  

<style>  
body {  
  margin: 0;  
  background: radial-gradient(circle at top, #111433, #0b0d1a);  
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;  
  color: white;  
  display: flex;  
  justify-content: center;  
  align-items: center;  
  height: 100vh;  
}  
  
#app {  
  width: 100%;  
  max-width: 420px;  
  padding: 20px;  
  text-align: center;  
  transition: opacity 0.4s ease, filter 0.4s ease;  
}  
  
.locked {  
  opacity: 0.12;  
  filter: blur(6px);  
  pointer-events: none;  
}  
  
/* XP + LEVEL */  
#xpContainer {  
  margin: 12px 0 8px;  
  background: #12142a;  
  border-radius: 999px;  
  padding: 4px;  
  box-shadow: inset 0 0 6px rgba(0,0,0,0.6);  
}  
  
#xpBar {  
  height: 14px;  
  width: 0%;  
  border-radius: 999px;  
  background: linear-gradient(  
    90deg,  
    #38bdf8,  
    #6366f1,  
    #a855f7,  
    #ec4899  
  );  
  transition: width 0.35s ease;  
}  
  
#xpMeta {  
  display: flex;  
  justify-content: space-between;  
  font-size: 0.75rem;  
  opacity: 0.8;  
  margin-bottom: 6px;  
}  
  
#result {  
  min-height: 120px;  
  max-height: 45vh;  
  overflow-y: auto;  
}  
  
.card {  
  margin: 6px 0;  
  padding: 12px;  
  border-radius: 14px;  
  background: #1a1d33;  
  animation: fadeIn 0.3s ease forwards;  
}  
  
.Common { border-left: 6px solid #b0b0b0; }  
.Rare { border-left: 6px solid #4da6ff; }  
.Epic { border-left: 6px solid #b066ff; }  
.Legendary { border-left: 6px solid gold; }  
  
button {  
  width: 100%;  
  padding: 14px;  
  font-size: 1.1rem;  
  border-radius: 14px;  
  border: none;  
  background: #4f46e5;  
  color: white;  
  cursor: pointer;  
  margin-top: 10px;  
}  
  
button:disabled {  
  opacity: 0.5;  
  cursor: not-allowed;  
}  
  
#historyBtn { background: #2a2e5a; }  
#titleBtn { background: #1f234a; }  
  
@keyframes fadeIn {  
  from { opacity: 0; transform: translateY(10px); }  
  to { opacity: 1; transform: translateY(0); }  
}  
  
/* TITLE */  
#bannerSplash {  
  display: flex;  
  position: fixed;  
  inset: 0;  
  z-index: 4000;  
  background: radial-gradient(circle at top, rgba(255,215,0,0.22), rgba(0,0,0,0.98));  
  backdrop-filter: blur(14px);  
  justify-content: center;  
  align-items: center;  
  text-align: center;  
}  
  
/* HISTORY */  
#historyOverlay {  
  display: none;  
  position: fixed;  
  inset: 0;  
  background: #0f1220;  
  z-index: 3000;  
  padding: 20px;  
  overflow-y: auto;  
}  
  
/* LEGENDARY */  
#legendaryOverlay {  
  display: none;  
  position: fixed;  
  inset: 0;  
  z-index: 5000;  
  background: radial-gradient(circle, rgba(255,215,0,0.35), rgba(0,0,0,0.95));  
  backdrop-filter: blur(6px);  
  justify-content: center;  
  align-items: center;  
  text-align: center;  
}  
/* ============================
   PHASE 4A â€” XP FEEDBACK VISUALS
   (CSS ONLY, SAFE)
============================ */

/* Floating XP gain text */
.xp-float {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-weight: 700;
  font-size: 0.9rem;
  opacity: 0;
  pointer-events: none;
  animation: xpFloatUp 1.1s ease-out forwards;
  text-shadow: 0 0 8px rgba(255,255,255,0.25);
  z-index: 2000;
}

.xp-common { color: #b0b0b0; }
.xp-rare { color: #4da6ff; }
.xp-epic { color: #b066ff; }
.xp-legendary { color: gold; }

/* XP float animation */
@keyframes xpFloatUp {
  0% {
    transform: translate(-50%, 8px);
    opacity: 0;
  }
  15% {
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -26px);
    opacity: 0;
  }
}

/* Level Up Overlay */
#levelUpOverlay {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 4500;
  background: radial-gradient(
    circle at center,
    rgba(168,85,247,0.35),
    rgba(0,0,0,0.85)
  );
  backdrop-filter: blur(6px);
  justify-content: center;
  align-items: center;
  text-align: center;
}

#levelUpOverlay h1 {
  font-size: 2.4rem;
  margin-bottom: 8px;
  background: linear-gradient(
    90deg,
    #38bdf8,
    #6366f1,
    #a855f7,
    #ec4899
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

#levelUpOverlay p {
  font-size: 1rem;
  opacity: 0.85;
}

/* LEVEL UP BANNER */
#levelUpBanner {
  position: fixed;
  top: 18px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 18px;
  border-radius: 999px;
  background: linear-gradient(90deg, #facc15, #f472b6, #a855f7);
  color: #0b0d1a;
  font-weight: 700;
  font-size: 0.9rem;
  opacity: 0;
  pointer-events: none;
  z-index: 4500;
  transition: opacity 0.4s ease;
}

</style> 

</head>  <body>  <div id="bannerSplash">  
  <div>  
    <h1 style="font-size:2.8rem;">ðŸŽ‚ LIMITED BIRTHDAY BANNER ðŸŽ‚</h1>  
    <p style="opacity:.85;margin:16px 0;">Available for a limited time only</p>  
    <button id="enterBanner" style="max-width:260px;">Enter Banner</button>  
  </div>  
</div>  
  <div id="levelUpBanner">âœ¨ LEVEL UP â€” Level 1 âœ¨</div>
  <div id="app">  
  <h1>ðŸŽ‚ Limited Birthday Banner</h1>  
  <p>Tap to Roll Ã—10</p>    <div id="xpMeta">  
    <span id="levelText">Level 1</span>  
    <span id="xpText">0 / 1000 XP</span>  
  </div>    <div id="xpContainer">  
    <div id="xpBar"></div>  
  </div>    <div id="pityDisplay" style="opacity:.7;font-size:.85rem;margin-bottom:6px;"></div>  
  <div id="result"></div>  
  <button id="rollBtn">ðŸŽ² Roll 10</button>  
  <button id="historyBtn">ðŸ“œ History</button>  
  <button id="titleBtn">ðŸŽ‚ Title Screen</button>  
</div>  <div id="historyOverlay">  
  <button id="closeHistory">Close</button>  
  <h2>Roll History</h2>  
  <div id="historyList"></div>  
</div>  <div id="legendaryOverlay">  
  <div>  
    <h1>ðŸŒŸ LEGENDARY ðŸŒŸ</h1>  
    <p id="legendaryPrize"></p>  
    <button id="ackLegendary">Accept Gift</button>  
  </div>  
</div>  <script>  
let isRolling = false;  
  
/* XP CONFIG */  
const XP_PER_BAR = 1000;  
  
const app = document.getElementById("app");  
const bannerSplash = document.getElementById("bannerSplash");  
const enterBanner = document.getElementById("enterBanner");  
const titleBtn = document.getElementById("titleBtn");  
const rollBtn = document.getElementById("rollBtn");  
const resultDiv = document.getElementById("result");  
const pityDisplay = document.getElementById("pityDisplay");  
  
const xpBar = document.getElementById("xpBar");  
const xpText = document.getElementById("xpText");  
const levelText = document.getElementById("levelText");  
  
const historyBtn = document.getElementById("historyBtn");  
const historyOverlay = document.getElementById("historyOverlay");  
const historyList = document.getElementById("historyList");  
const closeHistory = document.getElementById("closeHistory");  
  
const legendaryOverlay = document.getElementById("legendaryOverlay");  
const legendaryPrize = document.getElementById("legendaryPrize");  
const ackLegendary = document.getElementById("ackLegendary");  

/* XP CURVE CONFIG */
const BASE_XP = 120;
const GROWTH_XP = 55;
const MAX_XP = 1200;

function xpForLevel(level) {
  return Math.min(
    BASE_XP + (level - 1) * GROWTH_XP,
    MAX_XP
  );
}

/* STORAGE KEYS */  
const STORAGE_KEY = "birthday_roll_log";  
const PITY_KEY = "birthday_pity";  
const XP_KEY = "birthday_total_xp";  
  
/* TITLE */  
function showTitle() {  
  bannerSplash.style.display = "flex";  
  app.classList.add("locked");  
}  
function hideTitle() {  
  bannerSplash.style.display = "none";  
  app.classList.remove("locked");  
}  
showTitle();  
enterBanner.onclick = hideTitle;  
titleBtn.onclick = () => {  
  if (isRolling || legendaryOverlay.style.display === "flex") return;  
  showTitle();  
};  
  
/* STORAGE */  
function getRollLog() {  
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];  
}  
function saveRoll(entry) {  
  const log = getRollLog();  
  log.push(entry);  
  localStorage.setItem(STORAGE_KEY, JSON.stringify(log));  
}  
function getPity() {  
  return JSON.parse(localStorage.getItem(PITY_KEY)) || { legendary: 0 };  
}  
function savePity(p) {  
  localStorage.setItem(PITY_KEY, JSON.stringify(p));  
}  
  
/* XP STORAGE */  
function getTotalXP() {  
  return JSON.parse(localStorage.getItem(XP_KEY)) || 0;  
}  
function addXP(amount) {  
  const next = getTotalXP() + amount;  
  localStorage.setItem(XP_KEY, JSON.stringify(next));  
  return next;  
}  
  
/* XP + LEVEL */  
function getLevelFromXP(totalXP) {
  let level = 1;
  let xpRemaining = totalXP;

  while (xpRemaining >= xpForLevel(level)) {
    xpRemaining -= xpForLevel(level);
    level++;
  }

  return { level, xpIntoLevel: xpRemaining };
}

  
/* PATCH 1: LEVEL CHANGE DETECTION (LOGIC ONLY) */  
let lastKnownLevel = null;  
  
function detectLevelUp(currentLevel) {  
  if (lastKnownLevel !== null && currentLevel > lastKnownLevel) {
    showLevelUp(currentLevel);
    lastKnownLevel = currentLevel;  
    return true;  
  }  
  lastKnownLevel = currentLevel;  
  return false;  
}  

function showLevelUp(level) {
  if (legendaryOverlay.style.display === "flex") return;

  const banner = document.getElementById("levelUpBanner");
  banner.textContent = `âœ¨ LEVEL UP â€” Level ${level} âœ¨`;
  banner.style.opacity = "1";

  setTimeout(() => {
    banner.style.opacity = "0";
  }, 1200);
}  
  
function triggerLevelUpFX() {
  xpBar.classList.add("level-up");

  setTimeout(() => {
    xpBar.classList.remove("level-up");
  }, 900);
}
   
  
function updateXPUI() {  
  const totalXP = getTotalXP();  
  const currentXP = totalXP % XP_PER_BAR;  
  const percent = (currentXP / XP_PER_BAR) * 100;  
  const level = getLevel(totalXP);  
  
  xpBar.style.width = `${percent}%`;  
  xpText.textContent = `${currentXP} / ${XP_PER_BAR} XP`;  
  levelText.textContent = `Level ${level}`;  
  
  if (detectLevelUp(level)) {
    triggerLevelUpFX();
  }

}  
  
/* REWARDS + XP */  
const rewardPools = {  
  Epic: ["Prepared note","Small gift","10-minute massage"],  
  Legendary: ["Main Birthday Gift","Deep Handwritten Letter"]  
};  
  
const xpValues = {  
  Common: 10,  
  Rare: 25,  
  Epic: 60,  
  Legendary: 120  
};  
  
function rollOnce() {  
  const pity = getPity();  
  const chance = 1 + pity.legendary * 0.5;  
  if (pity.legendary >= 90) return "Legendary";  
  
  const n = Math.random() * 100;  
  if (n < chance) return "Legendary";  
  if (n < chance + 9) return "Epic";  
  if (n < chance + 29) return "Rare";  
  return "Common";  
}  
  
function getReward(rarity) {  
  return rewardPools[rarity]  
    ? rewardPools[rarity][Math.floor(Math.random() * rewardPools[rarity].length)]  
    : null;  
}  
  
function updatePityUI() {  
  pityDisplay.textContent = `Legendary Pity: ${getPity().legendary} / 90`;  
}  
  
updatePityUI();  
updateXPUI();  
  
/* ROLL */  
rollBtn.onclick = async () => {  
  isRolling = true;  
  rollBtn.disabled = true;  
  titleBtn.disabled = true;  
  resultDiv.innerHTML = "";  
  
  for (let i = 0; i < 10; i++) {  
    await new Promise(r => setTimeout(r, 250));  
  
    const rarity = rollOnce();  
    const xp = xpValues[rarity];  
    const reward = getReward(rarity);  
    const pity = getPity();  
  
    rarity === "Legendary" ? pity.legendary = 0 : pity.legendary++;  
    savePity(pity);  
    updatePityUI();  
  
    addXP(xp);  
    updateXPUI();  
  
    saveRoll({  
      rollNumber: getRollLog().length + 1,  
      rarity,  
      xp,  
      prize: reward,  
      timestamp: Date.now()  
    });  
  
    const card = document.createElement("div");  
    card.className = `card ${rarity}`;  
    card.innerHTML = `  
      <strong>${rarity}</strong><br>  
      +${xp} XP  
      ${reward ? `<br><em>${reward}</em>` : ""}  
    `;  
    resultDiv.appendChild(card);  
  
    if (rarity === "Legendary") {  
      hideTitle();  
      legendaryPrize.textContent = reward;  
      app.classList.add("locked");  
      legendaryOverlay.style.display = "flex";  
      break;  
    }  
  }  
  
  rollBtn.disabled = false;  
  titleBtn.disabled = false;  
  isRolling = false;  
};  
  
ackLegendary.onclick = () => {  
  legendaryOverlay.style.display = "none";  
  app.classList.remove("locked");  
};  
  
/* HISTORY */  
historyBtn.onclick = () => {  
  historyOverlay.style.display = "block";  
  renderHistory();  
};  
closeHistory.onclick = () => {  
  historyOverlay.style.display = "none";  
};  
  
function renderHistory() {  
  const log = getRollLog().slice().reverse();  
  historyList.innerHTML = log.length ? "" : "<p>No rolls yet.</p>";  
  for (const e of log) {  
    const div = document.createElement("div");  
    div.className = "card";  
    div.innerHTML = `  
      <strong>#${e.rollNumber}</strong> â€” ${e.rarity}<br>  
      +${e.xp} XP  
      ${e.prize ? `<br>${e.prize}` : ""}  
      <br><span style="opacity:.6;font-size:.8rem">  
        ${new Date(e.timestamp).toLocaleString()}  
      </span>`;  
    historyList.appendChild(div);  
  }  
}  
</script> 
</body>  
</html>
